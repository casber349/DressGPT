<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DressGPT - AI ç©¿æ­è©•åˆ†ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 15px; }
        .upload-card { 
            max-width: 1200px; 
            width: 100%; 
            margin: 0 auto; 
            padding: 25px; 
            border-radius: 20px; 
            background: white; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
        }

        /* æ ¸å¿ƒä½ˆå±€æ§åˆ¶ */
        .app-grid {
            display: grid;
            grid-template-columns: 1fr; /* æ‰‹æ©Ÿç‰ˆï¼šå–®æ¬„å‚ç›´ */
            gap: 25px;
        }

        /* é›»è…¦æ©«å±ç‰ˆï¼šä¸‰æ¬„ä¸¦æ’æˆ–äºŒå°ä¸€ä¸¦æ’ */
        @media (min-width: 992px) {
            .app-grid {
                grid-template-columns: 350px 1fr 300px; /* é è¦½ | é¸å–® | çµæœ */
                align-items: start;
            }
            .result-panel {
                position: sticky;
                top: 20px;
                height: auto;
            }
        }

        /* å…ƒç´ ç¾åŒ– */
        #preview { 
            width: 100%; 
            border-radius: 15px; 
            object-fit: cover;
            border: 2px dashed #dee2e6;
        }
        
        .result-box {
            background: #f8fbff;
            border: 1px solid #e1efff;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .score-display { 
            font-size: 4rem; 
            font-weight: 800; 
            color: #0d6efd; 
            line-height: 1;
            margin: 15px 0;
        }

        .rec-img { 
            width: 100%; 
            border-radius: 10px; 
            transition: 0.3s;
        }
        .rec-img:hover { transform: scale(1.05); }

        .btn-predict {
            background: linear-gradient(135deg, #0d6efd 0%, #004db3 100%);
            border: none;
            padding: 15px;
            font-weight: bold;
            border-radius: 10px;
        }
        
        /* ç¢ºä¿æ¨è–¦å€çš„åœ–ç‰‡åœ¨é›»è…¦ç‰ˆä¸æœƒå¤ªå¤§ */
        .rec-img { 
            width: 100%; 
            aspect-ratio: 3/4; /* çµ±ä¸€æ¯”ä¾‹ï¼Œé¿å…é•·çŸ­ä¸ä¸€ */
            object-fit: cover;
            border-radius: 8px;
        }

        /* è®“å³å´åˆ†æ•¸å¡ç‰‡æ›´æœ‰å­˜åœ¨æ„Ÿ */
        .result-box {
            background: linear-gradient(180deg, #ffffff 0%, #f0f7ff 100%);
            border: 2px solid #0d6efd;
            box-shadow: 0 5px 15px rgba(13, 110, 253, 0.1);
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="upload-card">
        <h2 class="text-center mb-4">âœ¨ DressGPT ç©¿æ­è¨ºæ–·ç³»çµ±</h2>
        
        <form id="uploadForm">
            <div class="app-grid">
                
                <div class="preview-panel">
                    <label class="form-label fw-bold">1. ç©¿æ­ç…§ç‰‡</label>
                    <input type="file" class="form-control mb-3" name="file" accept="image/*" id="imageInput" required>
                    <img id="preview" src="https://via.placeholder.com/400x500?text=Upload+Photo" alt="é è¦½å€åŸŸ">
                </div>

                <div class="config-panel">
                    <label class="form-label fw-bold">2. èƒŒæ™¯åƒæ•¸è¨­å®š</label>
                    <div class="row g-3">
                        <div class="col-6">
                            <label class="small text-muted">æ€§åˆ¥</label>
                            <select class="form-select" name="gender">
                                <option value="male">ç”·æ€§</option>
                                <option value="female">å¥³æ€§</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="small text-muted">å¹´é½¡å±¤</label>
                            <select class="form-select" name="age">
                                <option value="teenager">é’å°‘å¹´</option>
                                <option value="adult" selected>æˆå¹´äºº</option>
                                <option value="middle-aged">ä¸­å¹´</option>
                                <option value="elderly">è€å¹´</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="small text-muted">èº«æ</label>
                            <select class="form-select" name="body">
                                <option value="average" selected>æ™®é€š</option>
                                <option value="skinny">åç˜¦</option>
                                <option value="athletic">ç²¾å£¯/é‹å‹•å‹</option>
                                <option value="plus_size">å¤§å°ºç¢¼</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="small text-muted">å­£ç¯€</label>
                            <select class="form-select" name="season">
                                <option value="summer">å¤å­£</option>
                                <option value="winter">å†¬å­£</option>
                                <option value="spring/fall" selected>æ˜¥ç§‹å­£</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="small text-muted">å ´åˆ</label>
                            <select class="form-select" name="formal">
                                <option value="casual" selected>ä¼‘é–’æ—¥å¸¸ (Casual)</option>
                                <option value="formal">æ­£å¼å•†å‹™ (Formal)</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-predict w-100 mt-4" id="submitBtn">é–‹å§‹ AI è©•åˆ†</button>
                    
                    <div id="recommendationArea" class="mt-4" style="display: none;">
                        <label class="fw-bold mb-2">ğŸŒŸ æ¨è–¦é«˜åˆ†æ¨£å¼</label>
                        <div class="row g-2" id="recContainer"></div>
                    </div>
                </div>

                <div class="result-panel">
                    <div id="resultArea" style="display: none;">
                        <div class="result-box">
                            <h5 class="mb-0">AI è¨ºæ–·åˆ†æ•¸</h5>
                            <div class="score-display" id="scoreValue">0.0</div>
                            <p class="text-muted small">Score based on CLIP Fusion</p>
                            <div class="badge bg-primary px-3 py-2">è¨ºæ–·å®Œæˆ</div>
                        </div>
                    </div>
                </div>

            </div>
        </form>
    </div>
</div>

<script>
    // é è¦½åŠŸèƒ½
    document.getElementById('imageInput').onchange = evt => {
        const [file] = evt.target.files;
        if (file) {
            document.getElementById('preview').src = URL.createObjectURL(file);
            document.getElementById('preview').style.border = "none";
        }
    }

    // æäº¤è¡¨å–®
    document.getElementById('uploadForm').onsubmit = async (e) => {
        e.preventDefault();
        const submitBtn = document.getElementById('submitBtn');
        const resultArea = document.getElementById('resultArea');
        const scoreValue = document.getElementById('scoreValue');
        const recContainer = document.getElementById('recContainer');
        const recArea = document.getElementById('recommendationArea');

        submitBtn.disabled = true;
        submitBtn.innerText = "åˆ†æä¸­...";

        const formData = new FormData(e.target);
        
        try {
            const response = await fetch('/predict', { method: 'POST', body: formData });
            const data = await response.json();

            if (data.score !== undefined) {
                // æ›´æ–°åˆ†æ•¸ä¸¦é¡¯ç¤º
                scoreValue.innerText = data.score;
                resultArea.style.display = 'block';

                // æ›´æ–°æ¨è–¦
                if (data.recommendations && data.recommendations.length > 0) {
                    recContainer.innerHTML = '';
                    data.recommendations.forEach(item => {
                        recContainer.innerHTML += `
                            <div class="col-4 col-md-4 text-center">
                                <img src="${item.img_path}" class="rec-img mb-1 shadow-sm border">
                                <div class="badge bg-success" style="font-size: 0.7rem;">${item.score} åˆ†</div>
                            </div>
                        `;
                    });
                    recArea.style.display = 'block';
                }
            }
        } catch (err) {
            alert("ä¼ºæœå™¨æ•…éšœ");
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerText = "é–‹å§‹ AI è©•åˆ†";
        }
    };
</script>

</body>
</html>