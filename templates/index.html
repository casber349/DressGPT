<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DressGPT - AI ç©¿æ­è©•åˆ†ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 15px; }
        .upload-card { 
            max-width: 1200px; 
            width: 100%; 
            margin: 0 auto; 
            padding: 25px; 
            border-radius: 20px; 
            background: white; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
        }

        /* æ ¸å¿ƒä½ˆå±€æ§åˆ¶ */
        .app-grid {
            display: grid;
            grid-template-columns: 1fr; /* æ‰‹æ©Ÿç‰ˆï¼šå–®æ¬„å‚ç›´ */
            gap: 25px;
        }

        /* é›»è…¦æ©«å±ç‰ˆï¼šä¸‰æ¬„ä¸¦æ’æˆ–äºŒå°ä¸€ä¸¦æ’ */
        @media (min-width: 992px) {
            .app-grid {
                grid-template-columns: 350px 1fr 300px; /* é è¦½ | é¸å–® | çµæœ */
                align-items: start;
            }
            .result-panel {
                position: sticky;
                top: 20px;
                height: auto;
            }
        }

        /* å…ƒç´ ç¾åŒ– */
        #preview { 
            width: 100%; 
            border-radius: 15px; 
            object-fit: cover;
            border: 2px dashed #dee2e6;
        }
        
        .result-box {
            background: #f8fbff;
            border: 1px solid #e1efff;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .score-display { 
            font-size: 4rem; 
            font-weight: 800; 
            color: #0d6efd; 
            line-height: 1;
            margin: 15px 0;
        }

        .rec-img { 
            width: 100%; 
            border-radius: 10px; 
            transition: 0.3s;
        }
        .rec-img:hover { transform: scale(1.05); }

        .btn-predict {
            background: linear-gradient(135deg, #0d6efd 0%, #004db3 100%);
            border: none;
            padding: 15px;
            font-weight: bold;
            border-radius: 10px;
        }
        
        /* åœ¨ <style> ä¸­æ–°å¢æˆ–ä¿®æ”¹ */
        .ref-img-container {
            width: 100%;
            aspect-ratio: 9 / 16; /* å¼·åˆ¶åŸ·è¡Œ 9:16 æ¯”ä¾‹ */
            border-radius: 10px;
            overflow: hidden;
            background-color: #eee;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .ref-img-container img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* ç¢ºä¿ 9:16 å®Œæ•´é¡¯ç¤ºä¸è£åˆ‡ */
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="upload-card">
        <h2 class="text-center mb-4">âœ¨ DressGPT ç©¿æ­è¨ºæ–·ç³»çµ±</h2>
        
        <form id="uploadForm">
            <div class="app-grid">
                
                <div class="preview-panel">
                    <label class="form-label fw-bold">1. ç©¿æ­ç…§ç‰‡</label>
                    <input type="file" class="form-control mb-3" name="file" accept="image/*" id="imageInput" required>
                    <img id="preview" src="https://via.placeholder.com/400x500?text=Upload+Photo" alt="é è¦½å€åŸŸ">
                </div>

                <div class="config-panel">
                    <label class="form-label fw-bold">2. èƒŒæ™¯åƒæ•¸è¨­å®š</label>
                    <div class="row g-3">
                        <div class="col-6">
                            <label class="small text-muted">æ€§åˆ¥</label>
                            <select class="form-select" name="gender">
                                <option value="male">ç”·æ€§</option>
                                <option value="female">å¥³æ€§</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="small text-muted">å¹´é½¡å±¤</label>
                            <select class="form-select" name="age">
                                <option value="teenager">é’å°‘å¹´</option>
                                <option value="adult" selected>æˆå¹´äºº</option>
                                <option value="middle-aged">ä¸­å¹´</option>
                                <option value="elderly">è€å¹´</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="small text-muted">èº«æ</label>
                            <select class="form-select" name="body">
                                <option value="average" selected>æ™®é€š</option>
                                <option value="skinny">åç˜¦</option>
                                <option value="athletic">ç²¾å£¯/é‹å‹•å‹</option>
                                <option value="plus_size">å¤§å°ºç¢¼</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="small text-muted">å­£ç¯€</label>
                            <select class="form-select" name="season">
                                <option value="summer">å¤å­£</option>
                                <option value="winter">å†¬å­£</option>
                                <option value="spring/fall" selected>æ˜¥ç§‹å­£</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="small text-muted">å ´åˆ</label>
                            <select class="form-select" name="formal">
                                <option value="casual" selected>ä¼‘é–’æ—¥å¸¸ (Casual)</option>
                                <option value="formal">æ­£å¼å•†å‹™ (Formal)</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-predict w-100 mt-4" id="submitBtn">é–‹å§‹ AI è©•åˆ†</button>
                    
                    <div id="recommendationArea" class="mt-4" style="display: none;">
                        <label class="fw-bold mb-2">ğŸŒŸ æ¨è–¦é«˜åˆ†æ¨£å¼</label>
                        <div class="row g-2" id="recContainer"></div>
                    </div>
                </div>

                <div class="result-panel">
                    <div id="resultArea" style="display: none;">
                        <div class="result-box">
                            <h5 class="mb-0">AI è¨ºæ–·åˆ†æ•¸</h5>
                            <div class="score-display" id="scoreValue">0.0</div>
                            <p class="text-muted small">Score based on CLIP Fusion</p>
                            <div class="badge bg-primary px-3 py-2">è¨ºæ–·å®Œæˆ</div>
                        </div>
                        <div id="comparisonArea" class="row g-3 mb-4" style="display: none;">
                            <div class="col-6 text-center">
                                <span class="badge rounded-pill bg-success mb-2 px-3">è«‹åƒè€ƒ</span>
                                <div class="ref-img-container border border-success border-2">
                                    <img id="goodRefImg" src="">
                                </div>
                            </div>
                            <div class="col-6 text-center">
                                <span class="badge rounded-pill bg-danger mb-2 px-3">è«‹é¿å…</span>
                                <div class="ref-img-container border border-danger border-2">
                                    <img id="badRefImg" src="">
                                </div>
                            </div>
                        </div>
                        <div id="aiAdviceArea" class="mt-3" style="display: none;">
                            <div class="card shadow-sm border-0" style="border-radius: 15px; background: #fffcf0; border-left: 5px solid #ffc107 !important;">
                                <div class="card-body">
                                    <h6 class="card-title fw-bold text-warning-emphasis">ğŸ’¡ AI ç©¿æ­å»ºè­°</h6>
                                    <p id="adviceText" class="card-text small text-dark" style="line-height: 1.6;"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </form>
    </div>
</div>

<script>
    // é è¦½åŠŸèƒ½
    document.getElementById('imageInput').onchange = evt => {
        const [file] = evt.target.files;
        if (file) {
            document.getElementById('preview').src = URL.createObjectURL(file);
            document.getElementById('preview').style.border = "none";
        }
    }

    // æäº¤è¡¨å–®
    document.getElementById('uploadForm').onsubmit = async (e) => {
        e.preventDefault();
        const submitBtn = document.getElementById('submitBtn');
        const resultArea = document.getElementById('resultArea');
        const scoreValue = document.getElementById('scoreValue');
        const recContainer = document.getElementById('recContainer');
        const recArea = document.getElementById('recommendationArea');

        submitBtn.disabled = true;
        submitBtn.innerText = "åˆ†æä¸­...";

        const formData = new FormData(e.target);
        
        const adviceArea = document.getElementById('aiAdviceArea');
        const adviceText = document.getElementById('adviceText');

        try {
            const response = await fetch('/predict', { method: 'POST', body: formData });
            const data = await response.json();

            // åœ¨ index.html çš„æˆåŠŸè™•ç†é‚è¼¯ä¸­ (ç´„ line 168 é™„è¿‘)
            if (data.score !== undefined) {
                // 1. æ›´æ–°åˆ†æ•¸
                scoreValue.innerText = data.score;
                resultArea.style.display = 'block';

                // 2. æ›´æ–° AI å»ºè­°æ–‡å­—
                if (data.advice) {
                    adviceText.innerText = data.advice;
                    adviceArea.style.display = 'block';
                }

                // åœ¨æˆåŠŸå›å‚³æ•¸æ“šçš„è™•ç†å€å¡Šä¸­
                if (data.analysis) {
                    const compArea = document.getElementById('comparisonArea');
                    const goodImg = document.getElementById('goodRefImg');
                    const badImg = document.getElementById('badRefImg');
                    
                    // è¨­å®šåœ–ç‰‡è·¯å¾‘
                    goodImg.src = data.analysis.good_ref;
                    badImg.src = data.analysis.bad_ref;
                    
                    // ç¢ºä¿å€å¡Šé¡¯ç¤º
                    compArea.style.display = 'flex';
                }
            }
        } catch (err) {
            console.error(err);
            alert("ä¼ºæœå™¨æ•…éšœ");
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerText = "é–‹å§‹ AI è©•åˆ†";
        }
    };
</script>

</body>
</html>