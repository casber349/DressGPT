<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>DressGPT å¯©ç¾å°æ¨™ç‰†</title>
    <style>
        /* === CSS æ¨£å¼å€ === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
        }

        h1 { text-align: center; color: #fff; margin-bottom: 10px; }
        p.subtitle { text-align: center; color: #888; margin-bottom: 30px; }

        /* 4. èª¿æ•´ç¶²æ ¼ï¼Œç¢ºä¿ä¸‰æ¬„çš„å¯¬åº¦åˆ†é…æ›´å‡å‹» */
        .container {
            display: grid;
            /*grid-template-columns: 80px 340px 340px; /* å›ºå®šå¯¬åº¦ï¼Œé¿å…è‡ªå‹•æ’é–‹ */
            grid-template-columns: 80px 1fr 1fr;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
            align-items: start; /* æ”¹ç‚ºé ‚éƒ¨å°é½Šï¼Œé¿å…ç…§ç‰‡é«˜åº¦å¾®å·®å°è‡´éŒ¯ä½ */
        }

            /* ç”·æ€§/å¥³æ€§çš„å­å®¹å™¨ï¼Œå…§éƒ¨ä½¿ç”¨ flex æˆ– grid æ©«å‘æ’åˆ— */
        .gender-zone {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 15px;
        }

        /* æ¨™é¡Œåˆ— */
        .header {
            font-weight: bold;
            font-size: 1.2rem;
            text-align: center;
            padding: 15px;
            background-color: #333;
            border-radius: 8px;
            color: #ffcc00;
        }

        /* åˆ†æ•¸æ¨™ç±¤ */
        .score-label {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            color: #ffcc00;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* ä¿®æ”¹å¾Œçš„å¡ç‰‡èˆ‡åœ–ç‰‡æ¨£å¼ */
        .card {
            background-color: #1e1e1e;
            border-radius: 16px;
            padding: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            transition: transform 0.2s;
            border: 2px solid transparent;
            
            /* 1. å¼·åˆ¶å¡ç‰‡å¯¬åº¦ä¸€è‡´ */
            /*width: 300px;*/
            width: 100%; 
            margin: 0 auto; /* ç½®ä¸­ */
        }
        
        .card:hover { transform: translateY(-5px); z-index: 10; border-color: #666;}
        
        /* æ€§åˆ¥é¡è‰²å€åˆ† */
        .card.male { border-bottom: 4px solid #4da6ff; }
        .card.female { border-bottom: 4px solid #ff99cc; }

        .card img {
            /* 2. å¯¬åº¦å¡«æ»¿å¡ç‰‡ï¼Œé«˜åº¦ç”±æ¯”ä¾‹æ±ºå®š */
            width: 100%;
            aspect-ratio: 9 / 16; 
            
            /* 3. ç­‰æ¯”ä¾‹ç¸®æ”¾çš„æ ¸å¿ƒï¼šé€™è¡Œç¢ºä¿åœ–ç‰‡ä¸è®Šå½¢ï¼Œå¤šé¤˜çš„æœƒè¢«è£æ‰ */
            object-fit: cover; 
            
            border-radius: 12px;
            background-color: #000;
            display: block;
        }

        .info {
            padding: 12px 5px 5px 5px;
            font-size: 0.95rem;
        }

        .info .top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .info .id { font-weight: bold; color: #fff; }
        .info .score { color: #ffcc00; font-weight: bold; font-size: 1.1em; }
        
        .info .tags { 
            display: block; 
            font-size: 0.8rem; 
            color: #888; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            background: #2a2a2a;
            padding: 4px;
            border-radius: 4px;
        }
        
        .loading { grid-column: 1 / span 3; text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body>

    <h1>ğŸš€ DressGPT å¯©ç¾å°æ¨™ç‰†</h1>

    <div class="container" id="gallery">
        <div class="loading" id="loadingText">æ­£åœ¨è¼‰å…¥æ•¸æ“šèˆ‡åœ–ç‰‡...</div>
    </div>

    <script>
        // ä¿®æ”¹å¾Œçš„ç‰¹æ®Šè¡Œæ¸²æŸ“å‡½å¼
        function renderSpecialRow(label, subLabel, list, defaultColor) {
            const gallery = document.getElementById('gallery');
            const medalColors = ["#FFD700", "#C0C0C0", "#CD7F32", "#708090"]; 
            const dangerColors = ["#ff0000", "#cc0000", "#8b0000", "#4a0000"]; 
            // å®šç¾©åšåº¦é™£åˆ—ï¼šç¬¬ä¸€å(æˆ–æœ€å¾Œä¸€å) 6pxï¼Œä¾åºéæ¸›åˆ° 2px
            const borderThickness = ["6px", "4px", "3px", "2px"]; 

            const labelDiv = document.createElement('div');
            labelDiv.className = 'score-label';
            labelDiv.style.color = defaultColor; 
            labelDiv.innerHTML = `
                <div style="font-size: 1.5rem;">${label}</div>
                <div style="font-size: 0.7rem; color: #888; font-weight: normal;">${subLabel}</div>
            `;
            gallery.appendChild(labelDiv);

            const zones = [document.createElement('div'), document.createElement('div')];
            zones.forEach(z => { z.className = 'gender-zone'; });

            list.forEach((p, index) => {
                const card = createCard(p, 'special');
                let frameColor;

                if (label.includes("TOP")) {
                    frameColor = medalColors[index];
                } else if (label.includes("BTM")) {
                    frameColor = dangerColors[index]; // 0æ˜¯æœ€å¾Œä¸€åï¼Œå°æ‡‰é®®ç´…
                } else {
                    frameColor = defaultColor;
                }
                
                // --- å‹•æ…‹èª¿æ•´åšåº¦èˆ‡é¡è‰² ---
                card.style.borderColor = frameColor;
                card.style.borderWidth = borderThickness[index]; // è¶Šå‰é¢çš„åæ¬¡æ¡†è¶Šåš
                card.style.borderStyle = "solid"; // ç¢ºä¿é‚Šæ¡†æ¨£å¼å•Ÿå‹•
                
                // é…åˆåšåº¦ï¼ŒåŠ å¼·ç™¼å…‰åŠå¾‘ï¼ˆåšé‚Šæ¡†é…å¤§ç™¼å…‰ï¼‰
                const glowRadius = (6 - index) * 3; 
                card.style.boxShadow = `0 0 ${glowRadius}px ${frameColor}66`; 
                
                (index < 2 ? zones[0] : zones[1]).appendChild(card);
            });

            gallery.appendChild(zones[0]);
            gallery.appendChild(zones[1]);
        }

        const prMap = {
            "9": "PR 99.6", // ç¬¬4å / 1000äºº
            "8": "PR 97.7", // ç¬¬23å / 1000äºº
            "7": "PR 90.8", // ç¬¬92å / 1000äºº
            "6": "PR 74.9", // ç¬¬251å / 1000äºº
            "5": "PR 50.0", // ç¬¬500å / 1000äºº
            "4": "PR 25.1", // ç¬¬749å / 1000äºº
            "3": "PR 9.2", // ç¬¬908å / 1000äºº
            "2": "PR 2.3", // ç¬¬977å / 1000äºº
            "1": "PR 0.4" // ç¬¬996å / 1000äºº
        };
        
        document.addEventListener('DOMContentLoaded', async () => {
            const gallery = document.getElementById('gallery');
            const loadingText = document.getElementById('loadingText');

            try {
                const response = await fetch('/api/benchmarks');
                const resData = await response.json(); // å‡è¨­å¾Œç«¯æ”¹ç‚ºå›å‚³ç‰©ä»¶
                const data = resData.benchmarks;
                loadingText.style.display = 'none';

                if (data.error) {
                    gallery.innerHTML += `<div style="grid-column: 1/-1; color: red;">éŒ¯èª¤: ${data.error}</div>`;
                    return;
                }

                // 1. æ¸²æŸ“é ‚éƒ¨ã€Œå…¨å ´å¤©èŠ±æ¿ (TOP 4)ã€
                renderSpecialRow("ğŸ† TOP 4", "The Ceiling", resData.top_four, "#ffcc00");

                // ä¿®æ”¹ JS çš„æ¸²æŸ“éƒ¨åˆ†
                data.forEach(row => {
                    // (A) åˆ†æ•¸æ¨™ç±¤
                    const scoreDiv = document.createElement('div');
                    scoreDiv.className = 'score-label';
                    // --- é—œéµä¿®æ”¹é»ï¼šåŠ å…¥ PR å€¼é¡¯ç¤º ---
                    // row.score æ˜¯ 1~9 çš„æ•´æ•¸å­—ä¸²ï¼Œå°æ‡‰ prMap è£¡çš„ key
                    const prValue = prMap[row.score] || ""; 
                    
                    scoreDiv.innerHTML = `
                        ${row.score}
                        <div style="font-size: 1rem; color: #ccc; margin-top: 5px; text-shadow: none;">
                            ${prValue}
                        </div>
                    `;
                    // ----------------------------
                    gallery.appendChild(scoreDiv);

                    // (B) ç”·æ€§å€
                    const maleZone = document.createElement('div');
                    maleZone.className = 'gender-zone';
                    row.male_list.forEach(p => maleZone.appendChild(createCard(p, 'male')));
                    gallery.appendChild(maleZone);

                    // (C) å¥³æ€§å€
                    const femaleZone = document.createElement('div');
                    femaleZone.className = 'gender-zone';
                    row.female_list.forEach(p => femaleZone.appendChild(createCard(p, 'female')));
                    gallery.appendChild(femaleZone);
                });

                // 3. æ¸²æŸ“åº•éƒ¨ã€Œå…¨å ´åœ°æ¿ (BOTTOM 4)ã€
                renderSpecialRow("ğŸ’€ BTM 4", "The Floor", resData.bottom_four, "#ff4444");

            } catch (err) {
                console.error(err);
                loadingText.innerText = "é€£ç·šå¤±æ•—";
            }
        });

        function createCard(personData, genderType) {
            const card = document.createElement('div');
            card.className = `card ${genderType}`;

            if (!personData) {
                card.innerHTML = `
                    <div style="aspect-ratio: 9/16; display:flex; align-items:center; justify-content:center; background:#222; border-radius:12px; color:#555;">
                        N/A
                    </div>`;
            } else {
                card.innerHTML = `
                    <img src="${personData.img_path}" alt="${personData.id}" title="${personData.tags}">
                    <div class="info">
                        <div class="top-row">
                            <span class="id">ID: ${personData.id}</span>
                            <span class="score">${personData.score}</span>
                        </div>
                        <span class="tags" title="${personData.tags}">${personData.tags}</span>
                    </div>
                `;
            }
            return card;
        }
    </script>
</body>
</html>