==================================================
DressGPT 第八階段：集成學習架構與權重階層化 Prompt (Ensemble & Hierarchy Stage)
==================================================

核心檔案更新：
- train_DressGPT.py: 由全數據訓練轉向 5-Fold Cross Validation + Early Stopping 訓練模式 。
- predict_score.py: 重構為 Ensemble 預測機制，整合 5 個模型的權重進行平均評分 。
- fashion_advisor.py: 實作 A/B/C 三段式權重階層化 Prompt 引擎 。
- auto_tagger.py: 優化標籤過濾演算法，改用權重總和門檻機制，並排除非服裝標籤。
- app.py: 後台監控邏輯強化，新增大量診斷、權重計算與匹配細節之 Debug 訊息 。

--------------------------------------------------
技術細節與重大更新：

1. 引入5-Fold Cross Validation，並採用集成評分系統 (Ensemble Scorer)
   - 抗過擬合策略：為解決小樣本(400張)導致的嚴重 Overfitting 問題，全面改採 5-Fold Cross Validation。
   - 早停機制 (Early Stop): 訓練過程自動追蹤 Validation R2，若連續 50 Epoch 未提升則觸發早停，鎖定最佳泛化權重。
   - 多重模型評分機制: 推論時不再依賴單一權重檔案，而是載入 5 個獨立 Fold 模型進行平均運算。
   - 目前平均 Train R2 為 0.7750，Validation R2 為 0.5109。

2. 三段式階層權重 Prompt 引擎 (Tri-Tier Weighted Prompting)
   - 為解決生成過程中偶發的結構錯誤與衣服缺失問題，重新定義 Prompt 優先級邏輯:
   - Positive Prompt (C+ → B+ → A+):
      - C段 (診斷藥方)：最優先，直接放置客製化建議（如顏色修正、特定服飾），確保修改效果最顯著。
      - B段 (環境條件)：中優先，鎖定性別與季節標籤（如 (1man:1.2), winter outfit）。
      - A段 (畫質基礎)：基礎權重，維持 (properly clothed:1.3) 與畫質特徵 。
   - Negative Prompt (A- → B- → C-):
      - A段 (結構防線)：最高優先級，強力排除 (naked, nude, shirtless:1.3) 與 bad anatomy。
      - B段 (風格過濾)：中優先，排除不符性別或身材的特徵（如男裝排除 skirt, female curve）。
      - C段 (藥方排除)：低優先，排除與診斷建議相反的元素 。

3. 標籤精煉與 Auto-Tagger 優化:
   - 權重總和門檻過濾：在標籤選取時，不再僅依賴單一標籤強度，而是透過總和門檻篩選出真正具代表性的特徵，自動捨棄低強度雜訊。
   - 診斷範圍鎖定：在 C+/C-段Prompt 中自動過濾臉部相關標籤（如 face, eye），確保生成資源完全集中於服裝重繪，維持人物身份一致性。

4. 系統監控與 Debug 強化 (White-box Monitoring Plus)
   - 標籤強度追蹤：後台可監控所有候選標籤（如 clean, messy, color match）在相似度歸一化後的最終權重 。
   - Ensemble 詳細輸出：推論時即時顯示 Fold 1 至 Fold 5 每個模型的原始預測值，便於判斷評分的一致性 。

--------------------------------------------------
實驗結果:
原圖: 3.41 (PR 14)
DressGPT優化後 5.13 (PR 54)
==================================================